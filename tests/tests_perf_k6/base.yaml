apiVersion: k6.io/v1alpha1
kind: TestRun
metadata:
  name: warning-page
spec:
  parallelism: 8
  # cleanup: post
  script:
    localFile: $SCRIPT
  arguments: -o xk6-influxdb=http://influxdb-influxdb2.k6-operator-system:80 -e DATA_FILE=$DATA_FILE
  runner:
    image: 901127637159.dkr.ecr.eu-central-1.amazonaws.com/k6-runner:$TAG
    env:
      - name: K6_INFLUXDB_ORGANIZATION
        value: 'k6io'
      - name: K6_INFLUXDB_TOKEN
        value: EODLCYgBs62bENcpVQ3tv9YkDSevbusV
      - name: K6_INFLUXDB_BUCKET
        value: k6demo
      - name: DATA_FILE
        value: ${DATA_FILE}
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
                - key: "app"
                  operator: In
                  values:
                    - k6
            topologyKey: "kubernetes.io/hostname"
